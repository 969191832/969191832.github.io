<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>51å•ç‰‡æœºçŸ©é˜µé”®ç›˜æ‰«ææ¼”ç¤º (å¸¦å•æ­¥)</title>
    <style>
        :root {
            --primary-color: #3498db;
            --success-color: #2ecc71;
            --warning-color: #e67e22;
            --danger-color: #e74c3c;
            --bg-color: #f4f7f6;
            --panel-bg: #ffffff;
            --text-color: #333;
            --high-level: #e74c3c; /* çº¢è‰² 1 */
            --low-level: #2ecc71;  /* ç»¿è‰² 0 */
            --active-key: #f1c40f;
            --border-color: #ddd;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* å¸ƒå±€å®¹å™¨ */
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* å·¦ä¾§æ§åˆ¶æ  */
        .sidebar {
            width: 320px;
            background-color: var(--panel-bg);
            border-right: 1px solid var(--border-color);
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
            z-index: 10;
            overflow-y: auto;
        }

        .control-group {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 0.95em;
        }

        input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        /* æ–°å¢ï¼šæŒ‰é’®ç»„æ ·å¼ */
        .btn-group {
            display: flex;
            gap: 10px;
        }

        .ctrl-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-pause {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-pause:hover { background-color: #2980b9; }
        
        .btn-pause.is-paused {
            background-color: var(--success-color);
        }
        .btn-pause.is-paused:hover { background-color: #27ae60; }

        .btn-step {
            background-color: var(--warning-color);
            color: white;
        }
        .btn-step:hover { background-color: #d35400; }
        .btn-step:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .status-display {
            background: #2c3e50;
            color: #0f0;
            font-family: 'Courier New', Courier, monospace;
            padding: 15px;
            border-radius: 5px;
            margin-top: 5px;
            font-size: 13px;
            line-height: 1.5;
            min-height: 80px;
        }

        .legend {
            margin-top: auto;
            font-size: 0.85em;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
        }
        .dot { width: 10px; height: 10px; display: inline-block; border-radius: 50%; margin-right: 5px; }
        .dot-high { background-color: var(--high-level); }
        .dot-low { background-color: var(--low-level); }

        /* å³ä¾§æ¼”ç¤ºåŒº */
        .demo-area {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            background-color: #ecf0f1;
            padding: 20px;
        }

        /* æ¨¡æ‹Ÿç”µè·¯å¸ƒå±€ */
        .circuit-board {
            display: flex;
            gap: 50px;
            align-items: center;
        }

        /* MCU ç«¯å£æ¨¡æ‹Ÿ */
        .mcu-ports {
            display: flex;
            flex-direction: column;
            background: #34495e;
            padding: 20px;
            border-radius: 8px;
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            min-width: 120px;
        }
        .port-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 10px 0;
        }
        .port-title { font-size: 0.8em; text-align: center; opacity: 0.8; }
        
        .pin {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-family: monospace;
        }
        .led {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background-color: var(--high-level);
            transition: background-color 0.1s;
            border: 1px solid rgba(255,255,255,0.3);
            box-shadow: inset 0 0 2px rgba(0,0,0,0.5);
        }
        .led.low { background-color: var(--low-level); box-shadow: 0 0 8px var(--low-level); }

        /* çŸ©é˜µé”®ç›˜æ ·å¼ */
        .keypad-wrapper {
            position: relative;
            background: #bdc3c7;
            padding: 20px;
            border-radius: 10px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1), 0 5px 15px rgba(0,0,0,0.2);
        }

        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(4, 60px);
            grid-template-rows: repeat(4, 60px);
            gap: 15px;
        }

        .key-btn {
            width: 60px;
            height: 60px;
            background: #fdfdfd;
            border: 1px solid #ccc;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #95a5a6;
            transition: all 0.1s;
            user-select: none;
            position: relative;
            z-index: 2;
        }

        .key-btn:active, .key-btn.pressed {
            transform: translateY(4px);
            box-shadow: 0 0 0 #95a5a6;
            background-color: var(--active-key);
        }

        /* è¿çº¿åŠ¨ç”» (ç®€åŒ–ä¸ºèƒŒæ™¯ç½‘æ ¼çº¿) */
        .lines-layer {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 1;
        }
        
        /* ç®€åŒ–çš„è¿çº¿å¯è§†åŒ–ï¼šåœ¨æŒ‰é’®èƒŒå */
        .row-line {
            position: absolute;
            left: -30px; right: -30px;
            height: 4px;
            background: #ccc;
            z-index: 0;
            transition: background 0.1s;
            border-radius: 2px;
        }
        .col-line {
            position: absolute;
            top: -30px; bottom: -30px;
            width: 4px;
            background: #ccc;
            z-index: 0;
            transition: background 0.1s;
            border-radius: 2px;
        }

        /* æ¿€æ´»çŠ¶æ€çš„çº¿ */
        .row-line.active { background: var(--low-level); box-shadow: 0 0 5px var(--low-level); }
        .col-line.active { background: var(--low-level); box-shadow: 0 0 5px var(--low-level); }

        /* åº•éƒ¨çŸ¥è¯†ç‚¹ */
        .knowledge-base {
            height: 220px;
            background: #fff;
            border-top: 1px solid var(--border-color);
            padding: 20px;
            overflow-y: auto;
            box-sizing: border-box;
        }

        .knowledge-base h3 { margin-top: 0; color: var(--primary-color); font-size: 1.2em; }
        .knowledge-base ul { padding-left: 20px; margin: 10px 0; }
        .knowledge-base li { margin-bottom: 6px; line-height: 1.4; font-size: 0.95em; }
        code { background: #eee; padding: 2px 4px; border-radius: 3px; font-family: monospace; color: #c0392b; }

    </style>
</head>
<body>

<div class="container">
    <!-- å·¦ä¾§æ§åˆ¶é¢æ¿ -->
    <aside class="sidebar">
        <h2>âš™ï¸ æ§åˆ¶é¢æ¿</h2>
        
        <!-- æ–°å¢ï¼šåŠ¨ç”»æ§åˆ¶ -->
        <div class="control-group">
            <label>åŠ¨ç”»æ§åˆ¶</label>
            <div class="btn-group">
                <button id="btnPause" class="ctrl-btn btn-pause" onclick="togglePause()">
                    â¸ æš‚åœ
                </button>
                <button id="btnStep" class="ctrl-btn btn-step" onclick="manualStep()" disabled>
                    â­ å•æ­¥
                </button>
            </div>
            <div style="margin-top:8px; font-size:0.85em; color:#666;">
                æç¤º: æš‚åœåå¯ä½¿ç”¨å•æ­¥åŠŸèƒ½
            </div>
        </div>

        <div class="control-group">
            <label for="speedRange">è‡ªåŠ¨æ‰«æé€Ÿåº¦</label>
            <input type="range" id="speedRange" min="50" max="1500" value="800" step="50">
            <div style="text-align: right; font-size: 0.9em; color: #666;"><span id="speedVal">800</span> ms/è¡Œ</div>
        </div>

        <div class="control-group">
            <label>å½“å‰çŠ¶æ€:</label>
            <div id="statusLog" class="status-display">
                ç³»ç»Ÿåˆå§‹åŒ–å®Œæ¯•<br>
                å‡†å¤‡å¼€å§‹æ‰«æ...
            </div>
        </div>

        <div class="control-group">
            <label>æ£€æµ‹ç»“æœ:</label>
            <div style="font-size: 24px; font-weight: bold; text-align: center; padding: 15px; background: #ecf0f1; border-radius: 5px; border:1px solid #ddd;" id="resultDisplay">
                æ— æŒ‰é”®
            </div>
        </div>

        <div class="legend">
            <p style="margin:0 0 5px 0"><strong>å›¾ä¾‹è¯´æ˜:</strong></p>
            <div><span class="dot dot-high"></span> é«˜ç”µå¹³ (1) - çº¢</div>
            <div><span class="dot dot-low"></span> ä½ç”µå¹³ (0) - ç»¿</div>
            <div style="margin-top:5px; font-size:0.9em; color:#666;">(ç‚¹å‡»å³ä¾§æŒ‰é”®å¯æ¨¡æ‹ŸæŒ‰ä¸‹)</div>
        </div>
    </aside>

    <!-- å³ä¾§æ¼”ç¤ºåŒºåŸŸ -->
    <main class="demo-area">
        <div class="circuit-board">
            
            <!-- å•ç‰‡æœºç«¯å£æ˜¾ç¤º -->
            <div class="mcu-ports">
                <div style="text-align:center; margin-bottom:10px; font-weight:bold;">P1 ç«¯å£</div>
                
                <div class="port-title">åˆ— (è¾“å…¥)</div>
                <div class="port-group" id="colPorts">
                    <div class="pin"><span>P1.7</span><div class="led" id="led-7"></div></div>
                    <div class="pin"><span>P1.6</span><div class="led" id="led-6"></div></div>
                    <div class="pin"><span>P1.5</span><div class="led" id="led-5"></div></div>
                    <div class="pin"><span>P1.4</span><div class="led" id="led-4"></div></div>
                </div>

                <div style="height:1px; background:rgba(255,255,255,0.2); margin:5px 0;"></div>

                <div class="port-title">è¡Œ (è¾“å‡º)</div>
                <div class="port-group" id="rowPorts">
                    <div class="pin"><span>P1.3</span><div class="led" id="led-3"></div></div>
                    <div class="pin"><span>P1.2</span><div class="led" id="led-2"></div></div>
                    <div class="pin"><span>P1.1</span><div class="led" id="led-1"></div></div>
                    <div class="pin"><span>P1.0</span><div class="led" id="led-0"></div></div>
                </div>
            </div>

            <!-- é”®ç›˜çŸ©é˜µ -->
            <div class="keypad-wrapper" id="keypadWrapper">
                <!-- åŠ¨æ€ç”Ÿæˆçš„çº¿å°†æ”¾åœ¨è¿™é‡Œ -->
                <div class="lines-layer" id="linesLayer"></div>

                <div class="matrix-grid">
                    <!-- ç¬¬ä¸€è¡Œ -->
                    <div class="key-btn" data-r="0" data-c="0" onclick="toggleKey(this)">S1</div>
                    <div class="key-btn" data-r="0" data-c="1" onclick="toggleKey(this)">S2</div>
                    <div class="key-btn" data-r="0" data-c="2" onclick="toggleKey(this)">S3</div>
                    <div class="key-btn" data-r="0" data-c="3" onclick="toggleKey(this)">S4</div>
                    
                    <!-- ç¬¬äºŒè¡Œ -->
                    <div class="key-btn" data-r="1" data-c="0" onclick="toggleKey(this)">S5</div>
                    <div class="key-btn" data-r="1" data-c="1" onclick="toggleKey(this)">S6</div>
                    <div class="key-btn" data-r="1" data-c="2" onclick="toggleKey(this)">S7</div>
                    <div class="key-btn" data-r="1" data-c="3" onclick="toggleKey(this)">S8</div>

                    <!-- ç¬¬ä¸‰è¡Œ -->
                    <div class="key-btn" data-r="2" data-c="0" onclick="toggleKey(this)">S9</div>
                    <div class="key-btn" data-r="2" data-c="1" onclick="toggleKey(this)">S10</div>
                    <div class="key-btn" data-r="2" data-c="2" onclick="toggleKey(this)">S11</div>
                    <div class="key-btn" data-r="2" data-c="3" onclick="toggleKey(this)">S12</div>

                    <!-- ç¬¬å››è¡Œ -->
                    <div class="key-btn" data-r="3" data-c="0" onclick="toggleKey(this)">S13</div>
                    <div class="key-btn" data-r="3" data-c="1" onclick="toggleKey(this)">S14</div>
                    <div class="key-btn" data-r="3" data-c="2" onclick="toggleKey(this)">S15</div>
                    <div class="key-btn" data-r="3" data-c="3" onclick="toggleKey(this)">S16</div>
                </div>
            </div>

        </div>
    </main>
</div>

<!-- åº•éƒ¨çŸ¥è¯†ç‚¹ -->
<section class="knowledge-base">
    <h3>ğŸ“š 51å•ç‰‡æœºçŸ©é˜µé”®ç›˜ - æŸ¥è¯¢æ‰«ææ³•åŸç†</h3>
    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
        <div style="flex: 1; min-width: 280px;">
            <h4>1. ç«¯å£é…ç½®</h4>
            <ul>
                <li><strong>Row (è¡Œçº¿)</strong>: P1.0-P1.3ï¼Œæ¥è¾“å‡ºé©±åŠ¨ã€‚</li>
                <li><strong>Col (åˆ—çº¿)</strong>: P1.4-P1.7ï¼Œæ¥è¾“å…¥æ£€æµ‹ (é€šå¸¸å•ç‰‡æœºå†…éƒ¨æœ‰ä¸Šæ‹‰ç”µé˜»æˆ–å¤–éƒ¨æ¥ä¸Šæ‹‰)ã€‚</li>
            </ul>
        </div>
        <div style="flex: 1; min-width: 280px;">
            <h4>2. æ‰«ææµç¨‹ (é€è¡Œæ‰«æ)</h4>
            <ul>
                <li><strong>Loop</strong>: ä¾æ¬¡å°† P1.0, P1.1, P1.2, P1.3 æ‹‰ä½ (ç½®0)ï¼Œå…¶ä½™è¡Œä¸ºé«˜ã€‚</li>
                <li><strong>Check</strong>: åœ¨æ¯ä¸€è¡Œæ‹‰ä½æ—¶ï¼Œè¯»å– P1.4-P1.7ã€‚</li>
                <li><strong>Result</strong>: è‹¥è¯»åˆ°æŸä½ä¸º0ï¼Œè¯´æ˜è¯¥è¡Œè¯¥åˆ—çš„é”®è¢«æŒ‰ä¸‹ï¼ˆç”µè·¯å¯¼é€šï¼Œè¡Œçº¿æŠŠåˆ—çº¿ç”µå¹³æ‹‰ä½ï¼‰ã€‚</li>
            </ul>
        </div>
        <div style="flex: 1; min-width: 280px;">
            <h4>3. é”®å€¼è®¡ç®—ç¤ºä¾‹</h4>
            <ul>
                <li>ä¾‹å¦‚ï¼šæ‰«æç¬¬2è¡Œ (P1=<code>1111 1101</code>)ï¼Œæ­¤æ—¶æŒ‰ä¸‹ S6 (ç¬¬2è¡Œç¬¬2åˆ—)ã€‚</li>
                <li>åˆ—çº¿ P1.5 è¢«æ‹‰ä½ï¼ŒP1è¯»å–å€¼ä¸º <code>1101 1101</code> (0xDD)ã€‚</li>
                <li>ç¨‹åºæ£€æµ‹åˆ° P1.5 ä¸º 0ï¼Œç»“åˆå½“å‰è¡Œå·ï¼Œç¡®å®šæ˜¯ S6ã€‚</li>
            </ul>
        </div>
    </div>
</section>

<script>
    // --- é…ç½®ä¸çŠ¶æ€å˜é‡ ---
    let scanSpeed = 800;
    let currentRow = 0; // å½“å‰æ‰«æè¡Œ 0-3
    let intervalId = null;
    let pressedButton = null; // å½“å‰æŒ‰ä¸‹çš„ç‰©ç†æŒ‰é”® {r, c, el}
    let isPaused = false; // æš‚åœçŠ¶æ€æ ‡å¿—

    // --- DOM å…ƒç´  ---
    const speedInput = document.getElementById('speedRange');
    const speedVal = document.getElementById('speedVal');
    const statusLog = document.getElementById('statusLog');
    const resultDisplay = document.getElementById('resultDisplay');
    const linesLayer = document.getElementById('linesLayer');
    const btnPause = document.getElementById('btnPause');
    const btnStep = document.getElementById('btnStep');

    // --- åˆå§‹åŒ– ---
    function init() {
        initVisuals(); // ç»˜åˆ¶çº¿è·¯
        startAutoScan(); // é»˜è®¤å¼€å§‹è‡ªåŠ¨æ‰«æ
    }

    // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼çº¿
    function initVisuals() {
        // è¡Œçº¿ (P1.0-P1.3)
        for(let r=0; r<4; r++) {
            let line = document.createElement('div');
            line.className = 'row-line';
            line.id = `row-line-${r}`;
            // ä¼°ç®—ä½ç½®: padding(20) + buttonCenter(30) + index*(button(60)+gap(15))
            line.style.top = (50 + r * 75) + 'px'; 
            linesLayer.appendChild(line);
        }
        // åˆ—çº¿ (P1.4-P1.7)
        for(let c=0; c<4; c++) {
            let line = document.createElement('div');
            line.className = 'col-line';
            line.id = `col-line-${c}`;
            line.style.left = (50 + c * 75) + 'px';
            linesLayer.appendChild(line);
        }
    }

    // --- ç”¨æˆ·äº¤äº’ ---

    // åˆ‡æ¢æŒ‰é”®çŠ¶æ€ (è‡ªé”æ¨¡å¼ï¼Œæ¨¡æ‹ŸæŒ‰ä½ä¸æ”¾)
    window.toggleKey = function(el) {
        const r = parseInt(el.getAttribute('data-r'));
        const c = parseInt(el.getAttribute('data-c'));

        if (pressedButton && pressedButton.r === r && pressedButton.c === c) {
            // æ¾å¼€å½“å‰é”®
            pressedButton = null;
            el.classList.remove('pressed');
        } else {
            // å…ˆæ¾å¼€ä¹‹å‰çš„
            if(pressedButton) pressedButton.el.classList.remove('pressed');
            // æŒ‰ä¸‹æ–°çš„
            pressedButton = {r, c, el};
            el.classList.add('pressed');
        }
        // å¦‚æœå¤„äºæš‚åœçŠ¶æ€ï¼Œæ‰‹åŠ¨æ›´æ–°ä¸€ä¸‹æ˜¾ç¤ºï¼ˆå¯é€‰ï¼Œä½†ä¸ºäº†æ¼”ç¤ºé€»è¾‘ï¼Œä¸ç«‹å³åˆ·æ–°æ‰«æç»“æœï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡ScanStepï¼‰
    };

    // åˆ‡æ¢ æš‚åœ/ç»§ç»­
    window.togglePause = function() {
        isPaused = !isPaused;
        if (isPaused) {
            // è¿›å…¥æš‚åœ
            clearInterval(intervalId);
            intervalId = null;
            btnPause.innerHTML = "â–¶ ç»§ç»­";
            btnPause.classList.add('is-paused');
            btnStep.disabled = false; // å¯ç”¨å•æ­¥
            statusLog.innerHTML += `<br><span style="color:#f39c12">-- å·²æš‚åœ --</span>`;
        } else {
            // ç»§ç»­è¿è¡Œ
            startAutoScan();
            btnPause.innerHTML = "â¸ æš‚åœ";
            btnPause.classList.remove('is-paused');
            btnStep.disabled = true; // ç¦ç”¨å•æ­¥
        }
    }

    // å•æ­¥æ‰§è¡Œ
    window.manualStep = function() {
        if (!isPaused) return;
        scanStep();
    }

    // é€Ÿåº¦æ¡æ‹–åŠ¨
    speedInput.addEventListener('input', (e) => {
        scanSpeed = parseInt(e.target.value);
        speedVal.innerText = scanSpeed;
        // åªæœ‰åœ¨éæš‚åœçŠ¶æ€ä¸‹æ‰é‡ç½®å®šæ—¶å™¨
        if (!isPaused) {
            startAutoScan();
        }
    });

    function startAutoScan() {
        if (intervalId) clearInterval(intervalId);
        intervalId = setInterval(scanStep, scanSpeed);
    }

    // --- æ ¸å¿ƒæ‰«æé€»è¾‘ ---
    function scanStep() {
        // 1. æ¸…é™¤ä¸Šä¸€è¡Œçš„è§†è§‰æ•ˆæœ
        document.querySelectorAll('.row-line').forEach(l => l.classList.remove('active'));
        document.querySelectorAll('.col-line').forEach(l => l.classList.remove('active'));

        // 2. è®¡ç®—P1å£è¾“å‡ºå€¼ï¼šæ‹‰ä½å½“å‰è¡Œ
        // é«˜4ä½(Input)è®¾ä¸º1ï¼Œä½4ä½(Output)å½“å‰è¡Œè®¾ä¸º0
        let p1_value = 0xFF; 
        p1_value &= ~(1 << currentRow); // Bitwise clear bit at currentRow

        // è§†è§‰ï¼šç‚¹äº®å½“å‰è¡Œçº¿
        document.getElementById(`row-line-${currentRow}`).classList.add('active');

        // 3. æ¨¡æ‹Ÿç”µè·¯å¯¼é€šæ£€æµ‹
        let detected = false;
        let detectedCol = -1;

        // æ£€æŸ¥ç‰©ç†æŒ‰é”®æ˜¯å¦åœ¨å½“å‰è¡Œ
        if (pressedButton && pressedButton.r === currentRow) {
            detected = true;
            detectedCol = pressedButton.c;
            // ç”µè·¯çŸ­è·¯ï¼šå°†å¯¹åº”çš„åˆ—ä½æ‹‰ä½
            // Col 0å¯¹åº”P1.4 (bit 4), Col 1å¯¹åº”P1.5 (bit 5)...
            p1_value &= ~(1 << (detectedCol + 4)); 

            // è§†è§‰ï¼šç‚¹äº®åˆ—çº¿
            document.getElementById(`col-line-${detectedCol}`).classList.add('active');
        }

        // 4. æ›´æ–° UI æ˜¾ç¤º
        updateLEDs(p1_value);
        updateStatusLog(p1_value, detected, detectedCol);

        // 5. å‡†å¤‡ä¸‹ä¸€æ¬¡å¾ªç¯
        currentRow++;
        if (currentRow > 3) currentRow = 0;
    }

    // æ›´æ–°LEDç¯çŠ¶æ€
    function updateLEDs(val) {
        for(let i=0; i<8; i++) {
            const isHigh = (val >> i) & 1;
            const led = document.getElementById(`led-${i}`);
            if (isHigh) {
                led.classList.remove('low');
            } else {
                led.classList.add('low');
            }
        }
    }

    // æ›´æ–°æ–‡å­—æ—¥å¿—
    function updateStatusLog(p1Val, detected, colIndex) {
        let binStr = p1Val.toString(2).padStart(8, '0');
        // æ ¼å¼åŒ–äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼ŒåŠ ç©ºæ ¼æ–¹ä¾¿çœ‹ï¼š 1110 1111
        binStr = binStr.substring(0,4) + " " + binStr.substring(4);
        
        let html = `æ‰«æä¸­: ROW ${currentRow} (P1.${currentRow}=0)<br>`;
        html += `å¯„å­˜å™¨: ${binStr}<br>`;
        
        if (detected) {
            html += `<span style="color:#2ecc71"><strong>âœ… æ£€æµ‹åˆ°ä½ç”µå¹³!</strong></span>`;
            resultDisplay.innerText = `S${currentRow * 4 + colIndex + 1}`;
            resultDisplay.style.color = "#e74c3c";
            resultDisplay.style.borderColor = "#e74c3c";
        } else {
            html += `çŠ¶æ€: æ— å›è·¯å¯¼é€š`;
            // å¦‚æœæŒ‰ä¸‹äº†é”®ä½†æ²¡æ‰«åˆ°è¿™ä¸€è¡Œï¼Œæ˜¾ç¤ºæ‰«æä¸­ï¼›å¦‚æœæ²¡æŒ‰é”®ï¼Œæ˜¾ç¤ºæ— 
            if (!pressedButton) {
                resultDisplay.innerText = "æ— æŒ‰é”®";
                resultDisplay.style.color = "#7f8c8d";
                resultDisplay.style.borderColor = "#ddd";
            } else if (pressedButton.r !== currentRow) {
                 // æ­¤æ—¶æ­£åœ¨æ‰«å…¶ä»–è¡Œï¼Œä¿æŒä¸Šä¸€æ¬¡çš„ç»“æœæˆ–æ˜¾ç¤ºæ‰«æä¸­ï¼Œè¿™é‡Œé€‰æ‹©ä¸æ¸…é™¤ç»“æœï¼Œ
                 // åªæ˜¯è®©å®ƒçœ‹èµ·æ¥åƒæ˜¯åœ¨ç­‰å¾…æ‰«æåˆ°æ­£ç¡®çš„é‚£ä¸€è¡Œ
            }
        }
        statusLog.innerHTML = html;
    }

    // å¯åŠ¨ç¨‹åº
    init();

</script>
</body>
</html>