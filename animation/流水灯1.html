<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>51å•ç‰‡æœº P1å£æµæ°´ç¯æ¼”ç¤º</title>
    <style>
        :root {
            --primary-color: #3498db;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --dark-bg: #2c3e50;
            --light-bg: #ecf0f1;
            --led-off: #500000;
            --led-on: #ff0000;
            --wire-color: #7f8c8d;
            --wire-active: #2ecc71; /* å¯¼é€šæ—¶çš„é¢œè‰² */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #fdfdfd;
            color: #333;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ä¸»å¸ƒå±€ */
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* å·¦ä¾§æ§åˆ¶æ  */
        .sidebar {
            width: 320px;
            background-color: #fff;
            border-right: 1px solid #ddd;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            z-index: 10;
        }

        .sidebar h2 { color: var(--dark-bg); border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; }

        .control-group { margin-bottom: 25px; }
        
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }

        /* æŒ‰é’®ç»„ */
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        
        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .btn-play { background-color: var(--primary-color); color: white; }
        .btn-play:hover { background-color: #2980b9; }
        .btn-play.paused { background-color: var(--success-color); } /* ç»¿è‰²è¡¨ç¤ºç»§ç»­ */

        .btn-step { background-color: var(--warning-color); color: white; }
        .btn-step:hover { background-color: #d35400; }
        .btn-step:disabled { background-color: #bdc3c7; cursor: not-allowed; opacity: 0.7; }

        input[type="range"] { width: 100%; margin-top: 5px; }

        /* çŠ¶æ€æ˜¾ç¤ºå± */
        .lcd-screen {
            background: #222;
            color: #0f0;
            font-family: 'Courier New', Courier, monospace;
            padding: 15px;
            border-radius: 5px;
            border: 2px solid #555;
            box-shadow: inset 0 0 10px #000;
        }
        .lcd-row { margin-bottom: 5px; display: flex; justify-content: space-between; }
        .bit-val { color: #ff0; font-weight: bold; }

        /* å³ä¾§æ¼”ç¤ºåŒº */
        .demo-area {
            flex: 1;
            background-color: var(--light-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: auto;
        }

        /* ç”µè·¯æ¿å®¹å™¨ */
        .board {
            display: flex;
            gap: 60px;
            align-items: center;
            padding: 40px;
            background: #e0e5e9;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border: 1px solid #ccc;
        }

        /* å•ç‰‡æœºèŠ¯ç‰‡ */
        .mcu-chip {
            width: 140px;
            height: 360px;
            background: #333;
            border-radius: 4px;
            position: relative;
            color: #aaa;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 4px 4px 10px rgba(0,0,0,0.3);
        }
        .mcu-chip::before {
            content: "8051";
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-90deg);
            font-size: 30px;
            font-weight: bold;
            color: rgba(255,255,255,0.1);
        }
        .mcu-chip::after {
            content: "";
            position: absolute;
            top: 10px; left: 50%; transform: translateX(-50%);
            width: 20px; height: 20px;
            background: #222;
            border-radius: 50%;
        }

        /* ç«¯å£å¼•è„š */
        .port-label {
            position: absolute;
            right: 10px; top: -25px;
            font-weight: bold; color: #333;
        }
        
        .pins-container {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            height: 100%;
            padding: 20px 0;
        }

        .pin {
            height: 16px;
            background: #bbb;
            width: 15px; /* ä¼¸å‡ºèŠ¯ç‰‡ä¸€ç‚¹ */
            align-self: flex-end; /* é å³ */
            position: relative;
            display: flex;
            align-items: center;
        }
        .pin span {
            position: absolute;
            right: 20px;
            color: #fff;
            font-size: 12px;
            font-family: monospace;
            white-space: nowrap;
        }
        /* å¼•è„šç”µå¹³æŒ‡ç¤ºç‚¹ */
        .pin-state {
            width: 8px; height: 8px; border-radius: 50%;
            margin-left: 2px;
            background: #555; 
        }
        .pin-state.low { background: var(--success-color); box-shadow: 0 0 5px var(--success-color); } /* ä½ç”µå¹³äº® */
        .pin-state.high { background: var(--danger-color); } /* é«˜ç”µå¹³çº¢ */

        /* LED æ¨¡å— */
        .led-module {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            height: 320px; /* ä¸èŠ¯ç‰‡å¼•è„šå¯¹é½ */
            background: #2c3e50;
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid #34495e;
            position: relative;
        }
        
        .led-title {
            position: absolute;
            top: -25px; left: 50%; transform: translateX(-50%);
            font-weight: bold; color: #333; white-space: nowrap;
        }

        .led-unit {
            display: flex;
            align-items: center;
            gap: 15px;
            height: 16px; /* ä¸piné«˜åº¦ä¸€è‡´ */
        }

        .led-bulb {
            width: 24px;
            height: 24px;
            background-color: var(--led-off);
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.3);
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.5);
            transition: background-color 0.1s, box-shadow 0.1s;
        }
        
        /* LED ç‚¹äº®çŠ¶æ€ */
        .led-bulb.on {
            background-color: var(--led-on);
            box-shadow: 0 0 15px var(--led-on), inset -2px -2px 5px rgba(0,0,0,0.2);
            border-color: #ffcccc;
        }

        .resistor {
            width: 30px; height: 10px;
            background: repeating-linear-gradient(90deg, #d3b083, #d3b083 5px, #a52a2a 5px, #a52a2a 7px);
            border-radius: 2px;
            border: 1px solid #666;
        }

        /* è¿çº¿ SVG */
        .wires-svg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        line {
            stroke: var(--wire-color);
            stroke-width: 3;
            transition: stroke 0.1s;
        }
        line.active {
            stroke: var(--wire-active); /* ä½ç”µå¹³æ—¶å¯¼é€š */
        }

        /* åº•éƒ¨çŸ¥è¯†ç‚¹ */
        .footer {
            height: 220px;
            background: #fff;
            border-top: 1px solid #ddd;
            padding: 20px 40px;
            overflow-y: auto;
        }
        .footer h3 { color: var(--primary-color); margin-top: 0; }
        .code-block {
            background: #f4f4f4;
            padding: 10px;
            border-left: 4px solid var(--primary-color);
            font-family: monospace;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .theory-grid { display: flex; gap: 30px; }
        .theory-item { flex: 1; }

    </style>
</head>
<body>

<div class="container">
    <!-- ä¾§è¾¹æ  -->
    <aside class="sidebar">
        <h2>âš™ï¸ æ§åˆ¶é¢æ¿</h2>

        <div class="control-group">
            <label>åŠ¨ç”»æ§åˆ¶</label>
            <div class="btn-group">
                <button id="btnPlay" class="btn-play" onclick="togglePlay()">â¸ æš‚åœ</button>
                <button id="btnStep" class="btn-step" onclick="manualStep()" disabled>â­ å•æ­¥</button>
            </div>
        </div>

        <div class="control-group">
            <label for="speedRange">æµæ°´ç¯é€Ÿåº¦</label>
            <input type="range" id="speedRange" min="50" max="1000" value="500" step="50">
            <div style="display:flex; justify-content:space-between; font-size:12px; color:#666; margin-top:5px;">
                <span>å¿« (50ms)</span>
                <span id="speedDisplay">500 ms</span>
                <span>æ…¢ (1000ms)</span>
            </div>
        </div>

        <div class="control-group">
            <label>MCU å¯„å­˜å™¨çŠ¶æ€ (P1)</label>
            <div class="lcd-screen">
                <div class="lcd-row">
                    <span>BIN:</span>
                    <span id="binVal" class="bit-val">11111110</span>
                </div>
                <div class="lcd-row">
                    <span>HEX:</span>
                    <span id="hexVal" class="bit-val">0xFE</span>
                </div>
                <div style="height:1px; background:#444; margin:5px 0;"></div>
                <div class="lcd-row" style="font-size:12px; color:#ccc;">
                    <span>å½“å‰ç‚¹äº®:</span>
                    <span id="currentLedText">P1.0 (D1)</span>
                </div>
            </div>
        </div>

        <div style="margin-top:auto; font-size:13px; color:#7f8c8d; background:#f9f9f9; padding:10px; border-radius:5px;">
            <strong>ğŸ’¡ æç¤ºï¼š</strong><br>
            51å•ç‰‡æœº P1å£é€šå¸¸è¿æ¥LEDé˜´æã€‚<br>
            è¾“å‡º <strong>0 (ä½ç”µå¹³)</strong> -> LED äº®<br>
            è¾“å‡º <strong>1 (é«˜ç”µå¹³)</strong> -> LED ç­
        </div>
    </aside>

    <!-- æ¼”ç¤ºåŒº -->
    <main class="demo-area" id="demoArea">
        <div class="board">
            
            <!-- 8051 MCU -->
            <div class="mcu-chip">
                <div class="port-label">P1 PORT</div>
                <div class="pins-container">
                    <!-- è‡ªåŠ¨ç”Ÿæˆ P1.0 - P1.7 -->
                    <!-- è¿™é‡Œçš„IDæ˜¯ä¸ºäº†JSå®šä½è¿çº¿ -->
                    <div class="pin" id="pin-0"><span>P1.0</span><div class="pin-state" id="ps-0"></div></div>
                    <div class="pin" id="pin-1"><span>P1.1</span><div class="pin-state" id="ps-1"></div></div>
                    <div class="pin" id="pin-2"><span>P1.2</span><div class="pin-state" id="ps-2"></div></div>
                    <div class="pin" id="pin-3"><span>P1.3</span><div class="pin-state" id="ps-3"></div></div>
                    <div class="pin" id="pin-4"><span>P1.4</span><div class="pin-state" id="ps-4"></div></div>
                    <div class="pin" id="pin-5"><span>P1.5</span><div class="pin-state" id="ps-5"></div></div>
                    <div class="pin" id="pin-6"><span>P1.6</span><div class="pin-state" id="ps-6"></div></div>
                    <div class="pin" id="pin-7"><span>P1.7</span><div class="pin-state" id="ps-7"></div></div>
                </div>
            </div>

            <!-- è¿çº¿ SVG å±‚ -->
            <svg class="wires-svg" id="wiresSvg">
                <!-- çº¿æ¡ç”± JS åŠ¨æ€ç»˜åˆ¶ -->
            </svg>

            <!-- LED æ¨¡å— -->
            <div class="led-module">
                <div class="led-title">8è·¯ LED æ¨¡å— (å…±é˜³æ)</div>
                <!-- 8ä¸ª LED -->
                <div class="led-unit" id="unit-0"><div class="resistor"></div><div class="led-bulb" id="led-0"></div></div>
                <div class="led-unit" id="unit-1"><div class="resistor"></div><div class="led-bulb" id="led-1"></div></div>
                <div class="led-unit" id="unit-2"><div class="resistor"></div><div class="led-bulb" id="led-2"></div></div>
                <div class="led-unit" id="unit-3"><div class="resistor"></div><div class="led-bulb" id="led-3"></div></div>
                <div class="led-unit" id="unit-4"><div class="resistor"></div><div class="led-bulb" id="led-4"></div></div>
                <div class="led-unit" id="unit-5"><div class="resistor"></div><div class="led-bulb" id="led-5"></div></div>
                <div class="led-unit" id="unit-6"><div class="resistor"></div><div class="led-bulb" id="led-6"></div></div>
                <div class="led-unit" id="unit-7"><div class="resistor"></div><div class="led-bulb" id="led-7"></div></div>
            </div>

        </div>
    </main>
</div>

<!-- åº•éƒ¨çŸ¥è¯†ç‚¹ -->
<footer class="footer">
    <h3>ğŸ“š çŸ¥è¯†ç‚¹è¯¦è§£ï¼šå¾ªç¯æµæ°´ç¯</h3>
    <div class="theory-grid">
        <div class="theory-item">
            <h4>1. ç¡¬ä»¶è¿æ¥ (çŒç”µæµé©±åŠ¨)</h4>
            <p>51å•ç‰‡æœºIOå£æ‹‰ç”µæµèƒ½åŠ›å¼±ï¼ŒçŒç”µæµèƒ½åŠ›å¼ºã€‚å› æ­¤é€šå¸¸é‡‡ç”¨<strong>ä½ç”µå¹³é©±åŠ¨</strong>ï¼š</p>
            <ul>
                <li>LEDé˜³ææ¥ VCC (ç”µæº)ã€‚</li>
                <li>LEDé˜´æä¸²è”é™æµç”µé˜»æ¥ P1å£ã€‚</li>
                <li><strong>P1è¾“å‡º 0</strong> -> ç”µä½å·®å½¢æˆ -> ç”µæµæµè¿‡ -> <strong>ç¯äº®</strong>ã€‚</li>
                <li><strong>P1è¾“å‡º 1</strong> -> æ— ç”µä½å·® -> <strong>ç¯ç­</strong>ã€‚</li>
            </ul>
        </div>
        <div class="theory-item">
            <h4>2. æ ¸å¿ƒé€»è¾‘ (ä½ç§»)</h4>
            <p>è¦å®ç°æµæ°´ç¯ï¼Œå°±æ˜¯è®© 0 çš„ä½ç½®ä¸æ–­ç§»åŠ¨ã€‚ä»¥Cè¯­è¨€ä¸ºä¾‹ï¼š</p>
            <div class="code-block">
#include &lt;intrins.h&gt; // åŒ…å« _crol_ å‡½æ•°
void main() {
    unsigned char temp = 0xFE; // 1111 1110 (P1.0äº®)
    while(1) {
        P1 = temp;
        Delay(500);
        // å¾ªç¯å·¦ç§» 1 ä½
        temp = _crol_(temp, 1); 
        // ç»“æœå˜åŒ–: 11111110 -> 11111101 -> 11111011 ...
    }
}
            </div>
        </div>
        <div class="theory-item">
            <h4>3. æ¼”ç¤ºè¯´æ˜</h4>
            <p>å·¦ä¾§æ§åˆ¶é¢æ¿å¯ä»¥è°ƒèŠ‚å»¶æ—¶å‡½æ•°çš„é•¿åº¦ï¼ˆé€Ÿåº¦ï¼‰ã€‚ç‚¹å‡»â€œæš‚åœâ€åï¼Œä½¿ç”¨â€œå•æ­¥â€æŒ‰é’®å¯ä»¥æ¸…æ™°åœ°è§‚å¯Ÿæ¯ä¸€æ¬¡ä½ç§»æ“ä½œåå¯„å­˜å™¨å€¼çš„å˜åŒ–ã€‚</p>
        </div>
    </div>
</footer>

<script>
    // é…ç½®ä¸çŠ¶æ€
    let delayMs = 500;
    let currentBit = 0; // 0-7ï¼Œä»£è¡¨å½“å‰ç‚¹äº®çš„æ˜¯å“ªä¸€ä½
    let isRunning = true;
    let timerId = null;

    // DOM å…ƒç´ 
    const speedInput = document.getElementById('speedRange');
    const speedDisplay = document.getElementById('speedDisplay');
    const btnPlay = document.getElementById('btnPlay');
    const btnStep = document.getElementById('btnStep');
    const binValDisplay = document.getElementById('binVal');
    const hexValDisplay = document.getElementById('hexVal');
    const currentLedText = document.getElementById('currentLedText');
    const wiresSvg = document.getElementById('wiresSvg');

    // åˆå§‹åŒ–
    function init() {
        drawWires(); // ç»˜åˆ¶è¿çº¿
        updateState(); // åˆå§‹çŠ¶æ€
        startTimer();
        
        // çª—å£å¤§å°æ”¹å˜æ—¶é‡ç»˜è¿çº¿
        window.addEventListener('resize', () => {
            drawWires();
        });
    }

    // ç»˜åˆ¶è¿çº¿ (ä»Pinåˆ°LED)
    function drawWires() {
        wiresSvg.innerHTML = ''; // æ¸…ç©º
        const svgRect = wiresSvg.getBoundingClientRect();
        
        for(let i=0; i<8; i++) {
            const pin = document.getElementById(`pin-${i}`);
            const ledUnit = document.getElementById(`unit-${i}`);
            
            if(!pin || !ledUnit) continue;

            const pinRect = pin.getBoundingClientRect();
            const ledRect = ledUnit.getBoundingClientRect();

            // è®¡ç®—ç›¸å¯¹äºSVGå®¹å™¨çš„åæ ‡
            // èµ·ç‚¹ï¼šPinçš„å³è¾¹ç¼˜ä¸­é—´
            const x1 = pinRect.right - svgRect.left;
            const y1 = pinRect.top + pinRect.height/2 - svgRect.top;

            // ç»ˆç‚¹ï¼šLEDå•å…ƒçš„å·¦è¾¹ç¼˜ä¸­é—´
            const x2 = ledRect.left - svgRect.left;
            const y2 = ledRect.top + ledRect.height/2 - svgRect.top;

            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);
            line.setAttribute('id', `wire-${i}`);
            wiresSvg.appendChild(line);
        }
    }

    // æ ¸å¿ƒé€»è¾‘ï¼šæ›´æ–°çŠ¶æ€
    function updateState() {
        // 1. è®¡ç®—å¯„å­˜å™¨å€¼
        // Active Low: 0 æ˜¯äº®ã€‚æ‰€ä»¥ 1 << currentBit å¾—åˆ° 00000001ï¼Œå–åå¾—åˆ° 11111110
        // æ³¨æ„ï¼šæ¼”ç¤ºæ˜¯ä»ä¸Š(P1.0)åˆ°ä¸‹(P1.7)ï¼Œå¯¹åº”äºŒè¿›åˆ¶é€šå¸¸ä¹ æƒ¯ P1.7...P1.0
        // è¿™é‡Œçš„ currentBit 0 å¯¹åº” P1.0
        
        const val = ~(1 << currentBit) & 0xFF; // ä¿è¯æ˜¯8ä½

        // 2. æ›´æ–° UI æ˜¾ç¤º
        updateUI(val, currentBit);

        // 3. å‡†å¤‡ä¸‹ä¸€æ­¥ (å¾ªç¯ 0->7->0)
        currentBit++;
        if(currentBit > 7) currentBit = 0;
    }

    // æ›´æ–°UIè§†å›¾
    function updateUI(val, activeBitIndex) {
        // æ›´æ–°æ–‡æœ¬æ˜¾ç¤º
        const binStr = val.toString(2).padStart(8, '0');
        const hexStr = "0x" + val.toString(16).toUpperCase().padStart(2, '0');
        
        binValDisplay.innerText = binStr;
        hexValDisplay.innerText = hexStr;
        currentLedText.innerText = `P1.${activeBitIndex} (LED ${activeBitIndex+1})`;

        // æ›´æ–° LED, å¼•è„š å’Œ è¿çº¿ çŠ¶æ€
        for(let i=0; i<8; i++) {
            const isLow = !((val >> i) & 1); // ç¬¬iä½æ˜¯å¦ä¸º0
            
            const led = document.getElementById(`led-${i}`);
            const pinState = document.getElementById(`ps-${i}`);
            const wire = document.getElementById(`wire-${i}`);

            if (isLow) {
                // ä½ç”µå¹³ -> äº®
                led.classList.add('on');
                pinState.classList.remove('high');
                pinState.classList.add('low');
                if(wire) wire.classList.add('active');
            } else {
                // é«˜ç”µå¹³ -> ç­
                led.classList.remove('on');
                pinState.classList.remove('low');
                pinState.classList.add('high');
                if(wire) wire.classList.remove('active');
            }
        }
    }

    // æ’­æ”¾/æš‚åœåˆ‡æ¢
    window.togglePlay = function() {
        isRunning = !isRunning;
        if (isRunning) {
            btnPlay.innerHTML = "â¸ æš‚åœ";
            btnPlay.classList.remove('paused');
            btnStep.disabled = true;
            startTimer();
        } else {
            btnPlay.innerHTML = "â–¶ ç»§ç»­";
            btnPlay.classList.add('paused');
            btnStep.disabled = false;
            stopTimer();
        }
    };

    // å•æ­¥æ‰§è¡Œ
    window.manualStep = function() {
        if(isRunning) return;
        updateState();
    };

    // é€Ÿåº¦è°ƒèŠ‚
    speedInput.addEventListener('input', (e) => {
        delayMs = parseInt(e.target.value);
        // èŒƒå›´åè½¬æ˜¾ç¤ºé€»è¾‘ï¼ˆåªæ˜¯æ–‡æœ¬ï¼‰ï¼šå®é™…ä¸Šæ•°å€¼è¶Šå¤§è¶Šæ…¢
        // e.g. value=500ms
        speedDisplay.innerText = delayMs + " ms";
        
        if (isRunning) {
            stopTimer();
            startTimer();
        }
    });

    function startTimer() {
        if(timerId) clearInterval(timerId);
        timerId = setInterval(updateState, delayMs);
    }

    function stopTimer() {
        if(timerId) clearInterval(timerId);
        timerId = null;
    }

    // å¯åŠ¨
    // ç¨å¾®å»¶è¿Ÿä¸€ä¸‹ç­‰å¾…å¸ƒå±€æ¸²æŸ“å®Œæ¯•å†ç”»çº¿ï¼Œç¡®ä¿åæ ‡å‡†ç¡®
    setTimeout(init, 100);

</script>

</body>
</html>