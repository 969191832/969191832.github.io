<!-- START OF FILE 74HC595_Sim.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>74HC595 移位寄存器原理演示</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --chip-color: #333;
            --pin-color: #bbb;
            --signal-on: #e74c3c;
            --signal-off: #2ecc71;
            --data-bit: #3498db;
            --storage-bit: #9b59b6;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); margin: 0; display: flex; height: 100vh; }
        
        /* Layout */
        .controls { width: 300px; background: #fff; padding: 20px; border-right: 1px solid #ccc; display: flex; flex-direction: column; gap: 20px; }
        .display { flex: 1; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #dfe6e9;}

        /* Components */
        h2 { color: #2c3e50; margin: 0; }
        .btn { padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; color: white; transition: 0.1s; }
        .btn:active { transform: translateY(2px); }
        .btn-data { background: var(--data-bit); }
        .btn-clock { background: #e67e22; }
        .btn-latch { background: #16a085; }
        .btn-reset { background: #7f8c8d; margin-top: auto; }

        .signal-line { display: flex; align-items: center; justify-content: space-between; font-family: monospace; font-size: 1.2rem; background: #eee; padding: 10px; border-radius: 5px; }
        .led-indicator { width: 15px; height: 15px; border-radius: 50%; background: #ccc; }
        .led-indicator.high { background: var(--signal-on); box-shadow: 0 0 5px var(--signal-on); }

        /* Chip Visualization */
        .chip-container { position: relative; width: 600px; height: 350px; background: #fff; border-radius: 10px; border: 1px solid #ccc; padding: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        
        .register-row { display: flex; gap: 10px; margin-bottom: 40px; justify-content: center; }
        .bit-box { width: 40px; height: 40px; border: 2px solid #555; display: flex; align-items: center; justify-content: center; font-weight: bold; font-family: monospace; background: #fff; transition: all 0.3s; }
        
        .shift-reg .bit-box { border-color: var(--data-bit); color: var(--data-bit); }
        .storage-reg .bit-box { border-color: var(--storage-bit); color: var(--storage-bit); }
        .output-pins .bit-box { border-color: #333; background: #333; color: #555; border-radius: 50%; width: 30px; height: 30px; margin: 0 5px; }
        .output-pins .bit-box.on { background: var(--signal-on); box-shadow: 0 0 10px var(--signal-on); color: #fff; }

        .label { text-align: center; font-size: 0.9rem; color: #666; margin-bottom: 5px; font-weight: bold; }
        
        .arrow-down { text-align: center; font-size: 20px; color: #ccc; margin: -15px 0 5px 0; }

        /* Animation class */
        .shifting { transform: translateX(50px); opacity: 0.5; }

        .footer-note { font-size: 0.85rem; color: #666; line-height: 1.5; padding: 10px; background: #f9f9f9; border-radius: 5px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="controls">
    <h2>74HC595 演示</h2>
    <div style="font-size:0.9rem; color:#888;">8位串行输入/并行输出位移缓存器</div>

    <div>
        <div class="label" style="text-align:left">1. 数据输入 (DS / SER)</div>
        <div class="signal-line">
            <span>DATA</span>
            <div id="led-data" class="led-indicator"></div>
        </div>
        <button class="btn btn-data" style="width:100%; margin-top:5px;" onclick="toggleData()">切换数据 (0/1)</button>
    </div>

    <div>
        <div class="label" style="text-align:left">2. 移位时钟 (SH_CP / SRCLK)</div>
        <button class="btn btn-clock" style="width:100%" onmousedown="pulseClock()">产生脉冲 (上升沿)</button>
        <div style="font-size:0.8rem; color:#888; margin-top:5px;">数据移入内部移位寄存器</div>
    </div>

    <div>
        <div class="label" style="text-align:left">3. 锁存时钟 (ST_CP / RCLK)</div>
        <button class="btn btn-latch" style="width:100%" onmousedown="pulseLatch()">产生脉冲 (上升沿)</button>
        <div style="font-size:0.8rem; color:#888; margin-top:5px;">数据更新到输出引脚</div>
    </div>

    <button class="btn btn-reset" onclick="reset()">重置 (Reset)</button>

    <div class="footer-note">
        <strong>应用：</strong> 51单片机IO口有限，用3根线(DS, SH, ST)即可扩展出8个甚至更多(级联)输出口，常用于驱动点阵屏、数码管或多路LED。
    </div>
</div>

<div class="display">
    <div class="chip-container">
        <!-- Shift Register -->
        <div class="label">内部移位寄存器 (Shift Register)</div>
        <div class="register-row shift-reg" id="shift-row">
            <!-- 8 bits generated by JS -->
        </div>

        <div class="arrow-down">⬇️ Latch (ST_CP) ⬇️</div>

        <!-- Storage Register -->
        <div class="label">存储寄存器 (Storage Register)</div>
        <div class="register-row storage-reg" id="storage-row">
            <!-- 8 bits -->
        </div>

        <div class="arrow-down">⬇️ Output Enable (OE) ⬇️</div>

        <!-- Output Pins -->
        <div class="label">并行输出引脚 (Q0 - Q7)</div>
        <div class="register-row output-pins" id="output-row">
            <!-- 8 LEDs -->
        </div>
        
        <div style="position:absolute; top: 10px; right: 10px; font-weight:bold; color:#ddd; font-size:3rem; z-index:0;">595</div>
    </div>
</div>

<script>
    // State
    let dataBit = 0;
    let shiftReg = [0,0,0,0,0,0,0,0]; // Index 0 is input side (DS), Index 7 is overflow (Q7')
    let storageReg = [0,0,0,0,0,0,0,0];

    // DOM Generation
    const shiftRow = document.getElementById('shift-row');
    const storageRow = document.getElementById('storage-row');
    const outputRow = document.getElementById('output-row');

    function init() {
        renderBits();
        updateUI();
    }

    function renderBits() {
        shiftRow.innerHTML = '';
        storageRow.innerHTML = '';
        outputRow.innerHTML = '';

        // Render Shift Register (Left is DS input usually, let's visualize Left->Right shift)
        // Usually Q0 is LSB. For visualization: [DS] -> [0] [1] ... [7]
        // Let's display [7][6][5][4][3][2][1][0] <- DS comes from right?
        // Standard convention: DS enters LSB or MSB depending on implementation.
        // Let's assume standard: DS enters at index 0, everything shifts left.
        // Display: [7] [6] ... [1] [0] <--- Data In
        
        for (let i = 7; i >= 0; i--) {
            // Shift Reg
            let d = document.createElement('div');
            d.className = 'bit-box';
            d.innerText = shiftReg[i];
            d.id = `sr-${i}`;
            shiftRow.appendChild(d);

            // Storage Reg
            let s = document.createElement('div');
            s.className = 'bit-box';
            s.innerText = storageReg[i];
            s.id = `str-${i}`;
            storageRow.appendChild(s);

            // Output
            let o = document.createElement('div');
            o.className = 'bit-box ' + (storageReg[i] ? 'on' : '');
            o.title = `Q${i}`;
            outputRow.appendChild(o);
        }
    }

    function updateUI() {
        const led = document.getElementById('led-data');
        if(dataBit) led.classList.add('high');
        else led.classList.remove('high');
        
        renderBits();
    }

    function toggleData() {
        dataBit = dataBit ? 0 : 1;
        updateUI();
    }

    function pulseClock() {
        // Shift logic: Move everything to higher index
        // shiftReg[7] is lost (or goes to Q7')
        // shiftReg[0] takes dataBit
        
        // Animation effect (optional logic here)
        
        for(let i=7; i>0; i--) {
            shiftReg[i] = shiftReg[i-1];
        }
        shiftReg[0] = dataBit;
        
        updateUI();
        
        // Highlight effect on index 0
        const el = document.getElementById('sr-0');
        el.style.backgroundColor = '#dff9fb';
        setTimeout(() => el.style.backgroundColor = '#fff', 200);
    }

    function pulseLatch() {
        // Copy Shift Reg to Storage Reg
        storageReg = [...shiftReg];
        updateUI();
        
        // Visual flash
        const els = document.querySelectorAll('.storage-reg .bit-box');
        els.forEach(e => {
            e.style.backgroundColor = '#fab1a0';
            setTimeout(() => e.style.backgroundColor = '#fff', 200);
        });
    }

    function reset() {
        shiftReg.fill(0);
        storageReg.fill(0);
        dataBit = 0;
        updateUI();
    }

    init();

</script>
</body>
</html>